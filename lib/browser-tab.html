<!--
  file: browser-tab.html
  author: Clément Désiles <main@jokester.fr>
  repository: https://github.com/jokesterfr/browser-component
  licence: Mozilla Public License Version 2.0
  description: A tab for changing browsing context easily
-->
<template id="browser-tab">
	<style>
		:host {
			display: -webkit-box;
			display: flex;
			padding: 9px 25px 7px 40px;
			height: 29px;
			margin-left: -32px;
			min-width: 250px;
			max-width: 250px;
			-webkit-user-select: none;
			-moz-user-select: none;
			user-select: none;
			cursor: default;
			font-family: "Fira Sans Medium", Arial, sans-serif;
		}
		:host(:first-child) {
			margin-left: 0px;
		}

		:host(.appTab),
		:host(.newTab) {
			width: 36px;
			min-width: 36px;
			padding-left: 25px;
		}

		:host(.newTab) #favicon {
			background-image: url("../icons/newTab-Icon.svg");
			width: 32px;
			height: 32px;
			background-size: 32px 32px;
			margin-top: 0px;
			margin-left: 2px;
		}

		:host(:hover) {
			position: relative;
			background: url("../icons/tabBackgroundStart.svg") no-repeat left,
						url("../icons/tabBackgroundMiddle.svg") no-repeat 43px,
						url("../icons/tabBackgroundEnd.svg") no-repeat right;
		}

		:host(.appTab:hover),
		:host(.newTab:hover) {
			position: relative;
			background: url("../icons/tabBackgroundStart.svg") no-repeat left,
						url("../icons/tabBackgroundEnd.svg") no-repeat right;
		}

		/**
		Because for now Chrome does not support these instructions :(
		 I had to change the size of tabActiveMiddle precisely to the size we want it to.
		:host:hover {
			background-image: url("../icons/tabBackgroundStart.svg"),
												url("../icons/tabBackgroundMiddle.svg"),
												url("../icons/tabBackgroundEnd.svg");
			background-repeat: no-repeat,
												 no-repeat,
												 no-repeat;
			background-position: left,
													 43px,
													 right;
			background-size: 43px 45px,
											 calc(100% - 86px) 45px,
											 43px 45px;
		}
		*/

		/* CSS4 spec.. :(
		 * :host:hover + :hostSeparator,
		!:host:hover + :hostSeparator, {
			background-image: none;
		}*/

		:host(.active) {
			background: url("../icons/tabActiveStart.svg") no-repeat left,
						url("../icons/tabActiveMiddle.svg") no-repeat 42px,
						url("../icons/tabActiveEnd.svg") no-repeat right;
			z-index: 399;
			margin-top: 1px;
		}

		/**
		 Because for now Chrome does not support these instructions :(
		 I had to change the size of tabActiveMiddle precisely to the size we want it to.
		:host.active {
			position: relative;
			background-image: url("../icons/tabActiveStart.svg"),
												url("../icons/tabActiveMiddle.svg"),
												url("../icons/tabActiveEnd.svg");
			background-repeat: no-repeat,
												 no-repeat,
												 no-repeat;
			background-position: left,
													 43px,
													 right;
			background-size: 43px 45px,
											 calc(100% - 86px) 45px,
											 43px 45px;
			z-index: 399;
		}
		*/

		:host > #favicon {
			margin-right: 6px;
			width: 16px;
			height: 16px;
			background-image: url("../icons/defaultFavicon.png");
			opacity: .9;
			margin-top: 8px;
		}
		:host(.appTab) > #favicon,
		:host(.newTab) > #favicon {
			margin-right: 0;
		}

		:host > #label {
			-webkit-box-flex: 1;
			flex: 1;
			height: 34px;
			color: #DFDBD2;
			font-size: 16px;
			line-height: 34px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		:host(.active) > #label {
			color: #4C4C4C;
		}

		:host #close {
			width: 32px;
			height: 32px;
			background-image: url("../icons/close-simple-white.svg");
			background-repeat: no-repeat;
			background-position: center center;
			opacity: .8;
		}

		:host(.active) #close {
			background-image: url("../icons/close-simple.svg");
		}

		:host #close:hover {
			background-image: url("../icons/close-hover.svg");
		}
		:host #close:hover:active {
			background-image: url("../icons/close-active.svg");
		}
	</style>
	<div id="favicon"></div>
	<div id="label"></div>
	<div id="close"></div>
</template>
<script>
/* browser-tab */
(function () {
	'use strict';
	var prototype = Object.create(HTMLElement.prototype);
	var currentScript = document.currentScript;
	var template = currentScript.ownerDocument.querySelector('template#browser-tab');

	prototype.createdCallback = function() {
		var shadow = this.createShadowRoot();
		shadow.appendChild(template.content.cloneNode(true));

		// Register inner components
		this.close = shadow.querySelector('#close');
		this.label = shadow.querySelector('#label');
		this.favicon = shadow.querySelector('#favicon');

		// Fill label
		var label = this.getAttribute('label');
		label = label || 'New tab';
		this.label.textContent = label;

		// Register close event
		this.close.addEventListener('click', function (evt) {
			closeTab.call(this, evt);
		}.bind(this), false);

		// Register select event
		this.addEventListener('click', function (evt) {
			selectTab.call(this, evt);
		}.bind(this), false);
	};

	prototype.attachedCallback = function() {
		var evt = new CustomEvent('new-tab', { detail: { source: this }});
		this.parentNode.dispatchEvent(evt);
	};

	prototype.attributeChangedCallback = function (attr) {
		switch (attr) {
			case 'url':
				console.log('url attribute changed!!');
				// var label = this.shadow.getElementById('label');
				break;

			case 'label':
				var label = this.getAttribute('label');
				label = label || 'New tab';
				this.label.textContent = label;
				break;
		}
	};

	/**
	 * Select the current tab
	 */
	function selectTab(evt) {
		if (evt.which === 2) {
			return closeTab.call(this, evt);
		}
		evt.stopPropagation();
		evt = new CustomEvent('select-tab', { detail: { source: this }});
		this.parentNode.dispatchEvent(evt);
	}

	/**
	 * On clicking close icon, destroy current tab
	 */
	function closeTab(evt) {
		evt.stopPropagation();
		evt = new CustomEvent('closed-tab', { detail: { source: this }});
		this.parentNode.dispatchEvent(evt);
	}

	/**
	 * Register the element protoype
	 */
	document.registerElement('browser-tab', {
		prototype: prototype
	});
})();
</script>