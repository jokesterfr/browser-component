<!--
  file: browser-component.html
  author: Clément Désiles <main@jokester.fr>
  repository: https://github.com/jokesterfr/browser-component
  licence: Mozilla Public License Version 2.0
  description: Components for rendering browser style UIs
-->

<!-- Sub components which can be included -->
<link rel="import" href="./browser-button.html"></link>
<link rel="import" href="./browser-tabbar.html"></link>
<link rel="import" href="./browser-tab.html"></link>
<link rel="import" href="./browser-tab-separator.html"></link>
<link rel="import" href="./browser-tab-new.html"></link>
<link rel="import" href="./browser-toolbar.html"></link>
<link rel="import" href="./browser-navigation.html"></link>
<link rel="import" href="./browser-location.html"></link>

<!-- Browser component -->
<template id="browser-component">
	<style>
		:host {
			display: -webkit-box;
			display: flex;
			-webkit-box-orient: vertical;
			flex-direction: column;
			background-color: #3c3b37;
			font-family: 'Fira Sans', Arial, sans-serif;
			min-height: 100%;
		}
		:host #browser {
			display: block;
			height: 100%;
			height: 100vh;
		}
	</style>
	<div>
		<content></content>
	</div>
</template>

<script>
	(function () {
		'use strict';
		var prototype = Object.create(HTMLElement.prototype);
		var template = document.currentScript.ownerDocument.querySelector('template#browser-component');

		prototype.createdCallback = function () {
			var shadow = this.createShadowRoot();
			shadow.appendChild(template.content.cloneNode(true));
			var content = shadow.querySelector('content');

			// Add browser against type
			switch (this.getAttribute('type')) {
				case 'iframe':
					var iframe = document.createElement('iframe');
					iframe.setAttribute('id', 'browser');
					iframe.setAttribute('width', '100%');
					iframe.setAttribute('height', '100%');
					iframe.setAttribute('frameBorder', '0');
					iframe.setAttribute('seamless', 'seamless');
					iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-top-navigation allow-same-origin');
					content.parentNode.insertBefore(iframe, content.nextSibling);
					break;
				case 'webview':
				default:
					var webview = document.createElement('webview');
					webview.setAttribute('id', 'browser');
					content.parentNode.insertBefore(webview, content.nextSibling);
					break;
			}
			this.addEventListener('select-tab', function () {
				console.log('lfkdfldkjldfkjk')
			});

			this.addEventListener('location-changed', function (evt) {
				var uri = evt.detail.uri;
				shadow.querySelector('#browser').src = uri;
			});
		};

		prototype.attributeChangedCallback = function () {
			console.log('browser component attribute changed!!');
		};

		document.registerElement('browser-component', {
			prototype: prototype
		});
	})();
</script>